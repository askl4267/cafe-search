module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},40777,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d(){return(0,b.jsx)("header",{className:"sticky top-0 z-50 bg-cream-100/80 backdrop-blur border-b border-coffee-200",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center gap-3 px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-9 h-9 rounded-xl bg-coffee-600"}),(0,b.jsx)("div",{className:"font-display text-2xl tracking-wide",children:"Osaka Cafe Finder"})]}),(0,b.jsx)("div",{className:"ml-4 text-sm text-coffee-600 hidden md:block",children:"いまのおすすめ 42 件"}),(0,b.jsx)("div",{className:"ml-auto text-xs text-coffee-500",children:"Powered by Hot Pepper"})]})})}function e({midAreas:a,onToggleMidArea:c,smallAreas:d,showSmallPanel:e,onToggleSmallArea:f,parking:g,smoking:h,onParkingChange:i,onSmokingChange:j,onSearch:k}){return(0,b.jsx)("section",{className:"border-b border-coffee-100",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:py-12",children:[(0,b.jsx)("h1",{className:"font-display text-3xl sm:text-4xl text-coffee-800",children:"今日はどんなカフェ気分？"}),(0,b.jsx)("p",{className:"text-coffee-700/80 mt-2",children:"エリア・駐車・禁煙で絞って、雰囲気の合うお店を見つけよう。"}),(0,b.jsx)("div",{className:"mt-6 bg-cream-50/70 border border-coffee-200 rounded-2xl shadow-card p-4 sm:p-6",children:(0,b.jsxs)("section",{className:"bg-cream-100/60 border border-cream-200 rounded-2xl p-4",children:[(0,b.jsx)("h3",{className:"text-coffee-800 font-semibold mb-2",children:"エリア"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:a.map(a=>(0,b.jsx)("button",{type:"button","aria-pressed":a.selected,onClick:()=>c(a.code),className:`px-3 py-1.5 rounded-full border text-sm transition ${a.selected?"bg-coffee-700 text-white border-coffee-700":"border-coffee-200 text-coffee-800 hover:bg-cream-200/60"}`,children:a.count?`${a.name}（${a.count}）`:a.name},a.code))}),(0,b.jsxs)("div",{className:e?"space-y-3":"space-y-3 hidden",children:[(0,b.jsx)("div",{className:"text-sm text-coffee-700 font-semibold",children:"小エリア"}),d.length?(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2",children:d.map(a=>(0,b.jsxs)("label",{className:"flex items-center gap-2 rounded-xl border border-cream-300 bg-white px-3 py-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:a.checked,onChange:b=>f(a.code,b.target.checked),className:"rounded"}),(0,b.jsxs)("span",{className:"text-sm text-coffee-800",children:[a.name,a.count?`（${a.count}）`:""]})]},a.code))}):(0,b.jsx)("p",{className:"text-sm text-coffee-600",children:"選択中の条件に合う小エリアはありません。"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:[(0,b.jsxs)("label",{className:"block",children:[(0,b.jsx)("span",{className:"text-sm text-coffee-700",children:"駐車"}),(0,b.jsxs)("select",{className:"w-full rounded-xl border border-cream-300 bg-white p-2",value:g,onChange:a=>i(a.target.value),children:[(0,b.jsx)("option",{value:"any",children:"指定なし"}),(0,b.jsx)("option",{value:"has",children:"あり"}),(0,b.jsx)("option",{value:"none",children:"なし"})]})]}),(0,b.jsxs)("label",{className:"block",children:[(0,b.jsx)("span",{className:"text-sm text-coffee-700",children:"禁煙"}),(0,b.jsxs)("select",{className:"w-full rounded-xl border border-cream-300 bg-white p-2",value:h,onChange:a=>j(a.target.value),children:[(0,b.jsx)("option",{value:"any",children:"指定なし"}),(0,b.jsx)("option",{value:"non_smoking",children:"全面禁煙"}),(0,b.jsx)("option",{value:"has_non_smoking",children:"禁煙席あり"})]})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsx)("button",{type:"button",onClick:k,className:"w-full bg-coffee-600 hover:bg-coffee-700 text-white rounded-xl py-2",children:"検索する"})})]})]})})]})})}function f({cafe:a}){return(0,b.jsxs)("article",{className:"bg-cream-100 rounded-2xl shadow-card overflow-hidden flex flex-col h-full",children:[(0,b.jsx)("div",{className:"w-full aspect-4-3 bg-cover bg-center",style:{backgroundImage:`url(${a.image})`},role:"presentation"}),(0,b.jsxs)("div",{className:"p-4 flex flex-col gap-2 grow",children:[(0,b.jsx)("h3",{className:"font-semibold text-coffee-800 line-clamp-2 min-h-[2.5rem]",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-coffee-700 line-clamp-2 min-h-[2.5rem]",children:a.address}),(0,b.jsxs)("p",{className:"text-xs text-coffee-600",children:["禁煙: ",a.nonSmoking," ／ Wi-Fi: ",a.wifi," ／ 駐車: ",a.parking]}),(0,b.jsx)("p",{className:"text-sm text-coffee-600",children:a.description}),(0,b.jsx)("div",{className:"mt-auto pt-2",children:(0,b.jsx)("a",{href:"https://www.hotpepper.jp/",target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 text-sm text-white bg-coffee-600 hover:bg-coffee-700 px-3 py-1.5 rounded-lg",children:"HotPepperで見る"})})]})]})}function g({currentPage:a,totalPages:c,onPageChange:d}){let e=new Set;e.add(1);let f=Math.max(2,a-2),g=Math.min(c-1,a+2);for(let a=f;a<=g;a++)e.add(a);c>1&&e.add(c);let h=Array.from(e).sort((a,b)=>a-b);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("nav",{className:"mt-6 flex items-center justify-center gap-2","aria-label":"ページネーション",children:[(0,b.jsx)("button",{type:"button",className:"h-10 min-w-[52px] px-3 rounded-xl border border-coffee-200 bg-white text-coffee-800 transition disabled:opacity-40",disabled:a<=1,onClick:()=>d(Math.max(1,a-1)),children:"← 前へ"}),h.map((c,e)=>(0,b.jsxs)("span",{children:[e>0&&h[e-1]!==c-1&&(0,b.jsx)("span",{className:"px-2 text-coffee-500",children:"…"}),(0,b.jsx)("button",{type:"button",className:`h-10 min-w-[42px] px-3 rounded-xl border transition ${c===a?"bg-coffee-800 text-white border-coffee-800":"bg-white text-coffee-800 border-coffee-200 hover:bg-cream-200/60"}`,"aria-current":c===a?"page":void 0,onClick:()=>d(c),children:c})]},`page-group-${c}`)),(0,b.jsx)("button",{type:"button",className:"h-10 min-w-[52px] px-3 rounded-xl border border-coffee-200 bg-white text-coffee-800 transition disabled:opacity-40",disabled:a>=c,onClick:()=>d(Math.min(c,a+1)),children:"次へ →"})]}),(0,b.jsxs)("div",{className:"w-full text-center text-sm text-coffee-600 mt-2",children:[a," / ",c,"ページ"]})]})}function h({cafes:a,summary:c,loading:d,totalPages:e,currentPage:h,onPageChange:i,errorMessage:j}){let k=Array.from({length:6},(a,c)=>(0,b.jsx)("div",{className:"skeleton h-[220px] rounded-2xl"},`skeleton-${c}`));return(0,b.jsxs)("section",{className:"max-w-7xl mx-auto px-4 mt-6 space-y-4",children:[(0,b.jsxs)("p",{className:"text-sm text-coffee-700/80",children:["該当: ",c," 件"]}),j&&(0,b.jsx)("p",{className:"text-sm text-center text-red-600",children:j}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",id:"cards",children:d?k:a.length?a.map(a=>(0,b.jsx)(f,{cafe:a},a.name)):(0,b.jsx)("div",{className:"col-span-full text-center text-sm text-coffee-600",children:"条件に合うカフェが見つかりませんでした。"})}),(0,b.jsx)(g,{currentPage:h,totalPages:e,onPageChange:i})]})}let i="https://cafe-search-api.askl4267.workers.dev",j=(a,b="")=>"string"==typeof a?a:b,k=(a,b)=>{if("number"==typeof a)return Number.isFinite(a)?a:b;if("string"==typeof a&&a.trim()){let c=Number(a);return Number.isFinite(c)?c:b}return b},l=a=>{if("object"==typeof a&&null!==a)return a},m=a=>[...a].sort((a,b)=>a.localeCompare(b));function n(){let[a,f]=(0,c.useState)([]),[g,n]=(0,c.useState)([]),[o,p]=(0,c.useState)({}),[q,r]=(0,c.useState)({}),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)("any"),[y,z]=(0,c.useState)("any"),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(0),[E,F]=(0,c.useState)(1),[G,H]=(0,c.useState)(1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(null),O=(0,c.useMemo)(()=>new Set(s),[s]),P=(0,c.useMemo)(()=>new Set(u),[u]),Q=(0,c.useCallback)(async()=>{let a=new URLSearchParams({parking:w,smoking:y});s.length&&a.set("middle",s.join(","));let b=await fetch(`${i}/area_counts?${a.toString()}`);if(!b.ok)throw Error("件数の取得に失敗しました");let c=await b.json(),d=a=>(a||[]).reduce((a,b)=>{if(b?.code){let c=k(b.cnt??b.count,0);a[b.code]=c}return a},{});return{midMap:d(c.middle),smallMap:d(c.small)}},[w,y,s]),R=(0,c.useCallback)(async(a=1)=>{J(!0),N(null);try{let b=new URLSearchParams({parking:w,smoking:y,page:String(a)});s.length&&b.set("middle",s.join(",")),u.length&&b.set("small",u.join(","));let c=await fetch(`${i}/search?${b.toString()}`);if(!c.ok)throw Error("検索結果の取得に失敗しました");let d=await c.json(),e=Array.isArray(d.items)?d.items:[];B(e.map(a=>{var b;let c,d,e,f;return b="object"==typeof a&&null!==a?a:{},c=j(b.photo_l),f=(e=(d=l(b.photo))?l(d.pc):void 0)?j(e.l):"",{name:j(b.name,"Unnamed Cafe"),description:j(b.catch??b.description),address:j(b.address),parking:j(b.parking,"不明"),wifi:j(b.wifi,"不明"),nonSmoking:j(b.non_smoking,"不明"),image:c||f||"https://placehold.co/600x450?text=Cafe"}})),D(k(d.total,0)),H(Math.max(1,k(d.total_pages,1))),F(k(d.page??a,a))}catch(b){B([]),D(0),H(1),F(a),N(b instanceof Error?b.message:"検索結果の取得に失敗しました")}finally{J(!1)}},[w,y,s,u]),S=(0,c.useRef)(R);(0,c.useEffect)(()=>{S.current=R},[R]),(0,c.useEffect)(()=>{let a=!1;return(async()=>{try{let b=await fetch(`${i}/areas`);if(!b.ok)throw Error("エリア情報の取得に失敗しました");let c=await b.json();if(a)return;f(c.middle||[]),n(c.small||[]),L(null),await S.current(1)}catch(b){if(a)return;L(b instanceof Error?b.message:"エリア情報の取得に失敗しました")}})(),()=>{a=!0}},[]),(0,c.useEffect)(()=>{if(!a.length)return;let b=!0;return L(null),Q().then(({midMap:a,smallMap:c})=>{b&&(p(a),r(c))}).catch(a=>{b&&L(a instanceof Error?a.message:"件数の取得に失敗しました")}),()=>{b=!1}},[a.length,Q]);let T=(0,c.useCallback)(a=>{R(a)},[R]),U=(0,c.useMemo)(()=>a.map(a=>({...a,count:o[a.code]??0,selected:O.has(a.code)})),[a,o,O]),V=(0,c.useMemo)(()=>s.length?g.map(a=>({...a,count:q[a.code]??0,checked:P.has(a.code)})).filter(a=>(a.count??0)>0).sort((a,b)=>a.name.localeCompare(b.name,"ja")):[],[s.length,P,g,q]);return(0,b.jsxs)("div",{className:"min-h-screen text-coffee-900",children:[(0,b.jsx)(d,{}),(0,b.jsxs)("main",{className:"space-y-6 pb-16",children:[(0,b.jsx)(e,{midAreas:U,onToggleMidArea:a=>{t(b=>m(b.includes(a)?b.filter(b=>b!==a):[...b,a]))},smallAreas:V,showSmallPanel:!!s.length,onToggleSmallArea:(a,b)=>{v(c=>m(b?[...c,a]:c.filter(b=>b!==a)))},parking:w,smoking:y,onParkingChange:a=>x(a),onSmokingChange:a=>z(a),onSearch:()=>R(1)}),K&&(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 text-sm text-red-600",children:K}),(0,b.jsx)(h,{cafes:A,summary:C,loading:I,totalPages:G,currentPage:E,onPageChange:T,errorMessage:M})]})]})}a.s(["default",()=>n],40777)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5da9246e._.js.map