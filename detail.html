<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cafe Detail | Osaka Cafe Finder</title>

  <!-- フォント & 共通スタイル -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&family=Shippori+Mincho:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">

  <style>
    body::before{
      content:""; position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(167,127,87,.08), transparent 60%),
        radial-gradient(1000px 600px at 120% 10%, rgba(122,160,136,.06), transparent 60%),
        linear-gradient(180deg, #fff8ee, #fff1db 85%);
    }
    body::after{
      content:""; position:fixed; inset:0; z-index:-1; opacity:.25; pointer-events:none;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity=".06"/></svg>');
      background-size: 220px 220px; mix-blend-mode:multiply;
    }
    .skeleton{ background:linear-gradient(90deg,#f1e6d9 25%,#fff3e3 37%,#f1e6d9 63%); background-size:400% 100%; animation:shimmer 1.1s infinite; border-radius:16px }
    @keyframes shimmer { 0%{background-position:100% 0} 100%{background-position:-100% 0} }
  </style>
</head>

<body class="text-coffee-900 font-sans">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-cream-100/80 backdrop-blur border-b border-coffee-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
      <a href="/index.html" class="text-sm text-coffee-700 hover:underline">&larr; 一覧に戻る</a>
      <div class="ml-auto text-xs text-coffee-500">Powered by Hot Pepper</div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto px-4 py-6 sm:py-8">
    <!-- ヒーロー -->
    <section id="hero" class="bg-cream-50/70 border border-coffee-200 rounded-2xl overflow-hidden">
      <div class="w-full h-56 sm:h-80 bg-cream-200 skeleton" id="heroImgWrap"></div>
      <div class="p-4 sm:p-6">
        <h1 id="name" class="font-display text-2xl sm:text-3xl text-coffee-800">Loading...</h1>
        <p id="catch" class="mt-1 text-coffee-700/90"></p>

        <div class="mt-4 flex flex-wrap gap-2" id="badges">
          <!-- 動的に生成：禁煙 / Wi-Fi / 駐車 -->
        </div>

        <div class="mt-3 text-sm text-coffee-700" id="address"></div>
        <div class="mt-1">
          <a id="gmaps" target="_blank" rel="noopener" class="text-sm text-coffee-700 underline">Googleマップで開く</a>
        </div>

        <div class="mt-4 flex gap-2">
          <a id="hotpepper" target="_blank" rel="noopener"
             class="inline-flex items-center gap-1 text-sm text-white bg-coffee-600 hover:bg-coffee-700 px-3 py-1.5 rounded-lg">
            HotPepperで見る
          </a>
        </div>
      </div>
    </section>

    <!-- 情報2カラム -->
    <section class="mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- 左：基本情報 -->
      <article class="lg:col-span-2 bg-cream-50/70 border border-coffee-200 rounded-2xl p-4 sm:p-6">
        <h2 class="font-semibold text-coffee-800 mb-3">店舗情報</h2>
        <dl class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 gap-y-2">
          <dt class="text-sm text-coffee-600">店名（かな）</dt>
          <dd id="kana" class="sm:col-span-2"></dd>

          <dt class="text-sm text-coffee-600">エリア</dt>
          <dd id="area" class="sm:col-span-2"></dd>

          <dt class="text-sm text-coffee-600">予算目安</dt>
          <dd id="budget" class="sm:col-span-2"></dd>

          <dt class="text-sm text-coffee-600">席数</dt>
          <dd id="capacity" class="sm:col-span-2"></dd>

          <dt class="text-sm text-coffee-600">営業時間</dt>
          <dd id="open" class="sm:col-span-2 whitespace-pre-wrap"></dd>

          <dt class="text-sm text-coffee-600">定休日</dt>
          <dd id="close" class="sm:col-span-2 whitespace-pre-wrap"></dd>
        </dl>
      </article>

      <!-- 右：写真 -->
      <aside class="bg-cream-50/70 border border-coffee-200 rounded-2xl p-4 sm:p-6">
        <h2 class="font-semibold text-coffee-800 mb-3">写真</h2>
        <div id="photoWrap" class="aspect-[4/3] bg-cream-200 rounded-xl overflow-hidden skeleton"></div>
      </aside>
    </section>

    <!-- フッター補足 -->
    <section class="mt-6 text-xs text-coffee-600">
      データ提供: Recruit Hot Pepper / 最終更新: <span id="updated"></span>
    </section>
  </main>

  <script>
  (function(){
    'use strict';

    const API_BASE = "%API_BASE%";

    const $ = (sel)=>document.querySelector(sel);
    const fmt = (v, fallback='不明') => (v==null || v==='' ? fallback : String(v));
    const money = (n)=> (n==null ? '不明' : `¥${Number(n).toLocaleString()}`);

    function getId(){
      const u = new URL(location.href);
      return u.searchParams.get('id');
    }

    function badge(label){
      const span = document.createElement('span');
      span.className = 'inline-flex items-center px-2 py-1 rounded-lg border border-coffee-200 bg-white text-xs text-coffee-800';
      span.textContent = label;
      return span;
    }

    async function main(){
      const id = getId();
      if (!id){
        $('#name').textContent = 'IDが指定されていません';
        return;
      }
      try{
        const r = await fetch(`${API_BASE}/shop?id=${encodeURIComponent(id)}`);
        if (!r.ok){
          $('#name').textContent = '店舗が見つかりませんでした';
          return;
        }
        const j = await r.json();
        const s = j.item || {};

        // タイトル/キャッチ
        document.title = `${fmt(s.name, 'カフェ詳細')} | Osaka Cafe Finder`;
        $('#name').textContent = fmt(s.name);
        $('#catch').textContent = fmt(s.catch_text, '');

        // 住所・地図
        $('#address').textContent = fmt(s.address, '');
        const mapUrl = (s.lat!=null && s.lng!=null)
          ? `https://www.google.com/maps/search/?api=1&query=${s.lat},${s.lng}`
          : `https://www.google.com/maps/search/${encodeURIComponent(fmt(s.name,''))}`;
        $('#gmaps').href = mapUrl;

        // HotPepperリンク
        $('#hotpepper').href = fmt(s.urls_pc, '#');

        // バッジ
        const badges = $('#badges');
        badges.innerHTML = '';
        if (s.non_smoking) badges.appendChild(badge(`禁煙: ${s.non_smoking}`));
        if (s.wifi)        badges.appendChild(badge(`Wi-Fi: ${s.wifi}`));
        if (s.parking)     badges.appendChild(badge(`駐車: ${s.parking}`));
        if (!badges.children.length) badges.appendChild(badge('設備情報 不明'));

        // 基本情報
        $('#kana').textContent   = fmt(s.name_kana, '-');
        $('#area').textContent   = [fmt(s.middle_area_name,''), fmt(s.small_area_name,'')].filter(Boolean).join(' / ') || '不明';
        $('#budget').textContent = money(s.budget_avg);
        $('#capacity').textContent = (s.capacity==null ? '不明' : `${s.capacity}席`);
        $('#open').textContent   = fmt(s.open_text, '-');
        $('#close').textContent  = fmt(s.close_text, '-');

        // 画像
        const hero = $('#heroImgWrap');
        const photo = $('#photoWrap');
        const imgUrl = s.photo_l || 'https://placehold.co/800x600?text=Cafe';
        hero.classList.remove('skeleton');
        hero.innerHTML = `<img src="${imgUrl}" alt="" class="w-full h-full object-cover">`;
        photo.classList.remove('skeleton');
        photo.innerHTML = `<img src="${imgUrl}" alt="" class="w-full h-full object-cover">`;

        // 更新日
        if (s.updated_at){
          const d = new Date(Number(s.updated_at) * 1000);
          $('#updated').textContent = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        }else{
          $('#updated').textContent = 'N/A';
        }
      }catch(e){
        console.error(e);
        $('#name').textContent = '読み込み中にエラーが発生しました';
      }
    }

    document.addEventListener('DOMContentLoaded', main);
  })();
  </script>
</body>
</html>